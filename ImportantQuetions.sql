/* Creating database */
-- drop database gcetts;
create database gcetts;
use gcetts;

/* Hotel master table-Hotel */
DROP TABLE HOTEL;
CREATE TABLE HOTEL	(
	HOTELNO		VARCHAR(10),
	HOTELNAME	VARCHAR(20),
	CITY		VARCHAR(15) DEFAULT 'KOLKATA',
	STATUS		INT,
	CONSTRAINT PK_HNO 	PRIMARY KEY(HOTELNO),
	CONSTRAINT CHK1_HNO CHECK	(HOTELNO LIKE 'H%'),
	CONSTRAINT CHK2_STS CHECK	(STATUS IN(1,3,5))
);
DESCRIBE HOTEL;
-- INSERTING ENTITIES IN HOTEL ENTITY SET
INSERT INTO HOTEL(HOTELNO,HOTELNAME,STATUS)
VALUES('H001','TAJBENGAL',5);
INSERT INTO HOTEL VALUES('H002','ASHOKA','AIRPORT',3);
INSERT INTO HOTEL(HOTELNO,HOTELNAME,STATUS)
VALUES('H003','HINDUSTAN',3);
INSERT INTO HOTEL(HOTELNO,HOTELNAME,STATUS)
VALUES('H004','THE PARK',1);
INSERT INTO HOTEL VALUES('H005','HYATT','SALT LAKE',3);
INSERT INTO HOTEL(HOTELNO,HOTELNAME,STATUS)
VALUES('H006','ORCHID',3);
SELECT * FROM HOTEL;

/* Room master table-Room */
DROP TABLE ROOM;
CREATE TABLE ROOM	(
	ROOMNO		VARCHAR(10),
	HOTELNO		VARCHAR(10),
	BED			VARCHAR(10),
	RATE		DECIMAL(8,2), -- TREATET AS FLOAT WITH 2 DECIMAL PLACES
	TYPE		CHAR(3),
	FLOOR		INT,
	CONSTRAINT PK_RNO PRIMARY KEY(ROOMNO),
	CONSTRAINT CHK1_RNO CHECK	(ROOMNO LIKE 'R%'),
	CONSTRAINT FK_HNO FOREIGN KEY(HOTELNO) REFERENCES HOTEL(HOTELNO),
	CONSTRAINT CHK2_TYP CHECK	(TYPE IN('AC','NAC')),
	CONSTRAINT CHK3_FLR CHECK	(FLOOR BETWEEN 0 AND 5)
);
DESCRIBE ROOM;
-- INSERTING ENTITIES IN ROOM ENTITY SET
INSERT INTO ROOM VALUES('R001','H001','SINGLE',2200,'AC',1);
INSERT INTO ROOM VALUES('R002','H001','DOUBLE',4200,'NAC',0);
INSERT INTO ROOM VALUES('R003','H002','SOFA CUM',4800,'AC',2);
INSERT INTO ROOM VALUES('R004','H002','SINGLE',3000,'NAC',3);
INSERT INTO ROOM VALUES('R005','H003','DOUBLE',5000,'AC',1);
INSERT INTO ROOM VALUES('R006','H003','SINGLE',3000,'NAC',4);
INSERT INTO ROOM VALUES('R007','H003','SOFA CUM',4500,'AC',0);
INSERT INTO ROOM VALUES('R008','H004','SINGLE',2500,'NAC',2);
INSERT INTO ROOM VALUES('R009','H004','SOFA CUM',3500,'AC',3);
INSERT INTO ROOM VALUES('R010','H005','DOUBLE',3800,'NAC',4);
INSERT INTO ROOM VALUES('R011','H005','DOUBLE',4500,'AC',1);
INSERT INTO ROOM VALUES('R012','H006','SINGLE',2700,'NAC',2);
INSERT INTO ROOM VALUES('R013','H003','SINGLE',2000,'NAC',3);
SELECT * FROM ROOM;

/* Guest details table-Guest */
DROP TABLE GUEST;
CREATE TABLE GUEST	(
	GUESTNO			VARCHAR(10),
	GUESTNAME		VARCHAR(20),
	SEX				CHAR(1),
	GUESTID			VARCHAR(10),
	GUESTADDRESS	VARCHAR(15),
	NOMEMBER		INT DEFAULT 1,
	CONSTRAINT PK_GNO 	PRIMARY KEY(GUESTNO),
	CONSTRAINT CHK1_GNO CHECK	(GUESTNO LIKE 'G%'),
	CONSTRAINT CHK2_SEX CHECK	(SEX IN('M','F'))
);
DESCRIBE GUEST;
-- INSERTING ENTITIES IN GUEST ENTITY SET
INSERT INTO GUEST VALUES('G001','NAREN KUMAR','M','AODPN8133Q','DELHI',1);
INSERT INTO GUEST VALUES('G002','AMRITA ROY','F','AEWPM7385L','BANGALORE',2);
INSERT INTO GUEST VALUES('G003','SAIKAT SINHA','M','APWKL2532Q','HYDERABAD',2);
INSERT INTO GUEST VALUES('G004','KIRAN KHAN','F','AWPOL253M','MUMBAI',4);
INSERT INTO GUEST VALUES('G005','SUKUMAR DAS','M','ARTP35629Q','KOLKATA',1);
INSERT INTO GUEST VALUES('G006','HARI HAR','M','ADFPL4563Q','HYDERABAD',3);
SELECT * FROM GUEST;

/* Booking details table-Booking */
DROP TABLE BOOKING;
CREATE TABLE BOOKING	(
	BOOKID		VARCHAR(5),
	HOTELNO		VARCHAR(10),
	GUESTNO		VARCHAR(10),
	DATEFROM	DATE,
	DATETO		DATE,
	ROOMNO		VARCHAR(10) /*on delete set null*/,
	CONSTRAINT PK_BNO 	PRIMARY KEY(BOOKID),
	CONSTRAINT CHK1_BNO CHECK	(BOOKID LIKE 'B%'),
	CONSTRAINT FK1_HNO 	FOREIGN KEY(HOTELNO) REFERENCES HOTEL(HOTELNO),
	CONSTRAINT FK_GNO 	FOREIGN KEY(GUESTNO) REFERENCES GUEST(GUESTNO),
	CONSTRAINT FK_RNO 	FOREIGN KEY(ROOMNO) REFERENCES ROOM(ROOMNO)
);
DESCRIBE BOOKING;
-- INSERTING ENTITIES IN BOOKING ENTITY SET
INSERT INTO BOOKING VALUES('B0001','H001','G001','2014-01-20','2014-02-02','R002');
INSERT INTO BOOKING VALUES('B0002','H001','G002','2014-01-05','2014-02-12','R002');
INSERT INTO BOOKING VALUES('B0003','H002','G003','2014-03-10','2014-03-15','R003');
INSERT INTO BOOKING VALUES('B0004','H003','G004','2014-01-30','2014-02-07','R008');
INSERT INTO BOOKING VALUES('B0005','H004','G001','2014-03-21','2014-03-29','R007');
INSERT INTO BOOKING VALUES('B0006','H004','G005','2014-02-22','2014-02-28','R007');
INSERT INTO BOOKING VALUES('B0007','H004','G006','2014-01-10',NULL,'R009');
INSERT INTO BOOKING VALUES('B0008','H005','G002','2014-02-12','2014-02-22','R009');
INSERT INTO BOOKING VALUES('B0009','H005','G006','2014-03-02','2014-03-15','R010');
INSERT INTO BOOKING VALUES('B0010','H006','G006','2014-04-06','2014-04-18','R012');
INSERT INTO BOOKING VALUES('B0011','H006','G003','2014-04-12','2014-04-21','R012');
SELECT * FROM BOOKING;
-- FINALLY COMMIT FOR PERMANENTALLY SAVED
COMMIT;

/* Single Table Retrival */
-- Q1>List full details of hotels.
SELECT * FROM HOTEL;
-- Q2>List full details of all 5 star hotels in kolkata and slat lake.
SELECT * FROM HOTEL WHERE STATUS=5 AND (CITY='KOLKATA' OR CITY='SALT LAKE');
-- Q3>Find the name all guests whose name starts with 's' or 'A'.
SELECT GUESTNAME FROM GUEST WHERE (GUESTNAME LIKE 'S%') OR (GUESTNAME LIKE 'A%');
-- Q4>Name of all guests whose name's first character should not be 'N','H','A'.
SELECT GUESTNAME FROM GUEST WHERE NOT((GUESTNAME LIKE 'N%') OR (GUESTNAME LIKE 'H%') OR (GUESTNAME LIKE 'A%'));
-- Q5>List the name and cities of all guests,ordered according to their cities.
SELECT GUESTNAME,GUESTADDRESS FROM GUEST ORDER BY GUESTADDRESS ASC;
-- Q7>Show the list of all non repetitive guest no. from booking table.
SELECT DISTINCT GUESTNO FROM BOOKING;
-- Q8>List all rooms and type having rate within rs.3000 to rs.4000.00
SELECT ROOMNO,TYPE FROM ROOM WHERE RATE BETWEEN 3000 AND 4000;
-- Q9>List all details of rooms with price between rs.3000 and rs.4500.
SELECT * FROM ROOM WHERE RATE BETWEEN 3000 AND 4500;
-- Q10>List all double rooms with a price below rs.4000 in ascending order of price.
SELECT ROOMNO FROM ROOM WHERE BED='DOUBLE' AND RATE<=4000 ORDER BY RATE ASC;
-- Q11>List the hotels booked in the month of 'March 2014'.
SELECT HOTELNO FROM BOOKING WHERE EXTRACT(MONTH FROM DATEFROM)=3 AND EXTRACT(YEAR FROM DATEFROM)=2014;
-- Q12>List the bookings for which no date_to has been specified. 
SELECT * FROM BOOKING WHERE (EXTRACT(YEAR FROM DATETO)) IS NULL;
SELECT * FROM BOOKING where DATETO IS NULL;
-- Q13>Update the rate of all rooms by 10%.
SELECT RATE *1.10 RS FROM ROOM;
UPDATE ROOM SET RATE = RATE*1.10;
SELECT RATE FROM ROOM;
-- Q14>Create a table visitors of same structure as Guest. Insert three records.
CREATE TABLE VISITORS AS (SELECT * FROM GUEST WHERE 1=0);
SELECT * FROM VISITORS;
INSERT INTO VISITORS VALUES('G001','NAREN KUMAR','M','AODPN8133Q','DELHI',1);
INSERT INTO VISITORS VALUES('G002','AMRITA ROY','F','AEWPM7385L','BANGALORE',2);
INSERT INTO VISITORS VALUES('G003','SAIKAT SINHA','M','APWKL2532Q','HYDERABAD',2);
-- Q15>Rename the table visitors as Corporates.
ALTER TABLE VISITORS RENAME TO CORPORATES;
DROP TABLE CORPORATES;
ROLLBACK;

/* Table Update and Alert */
-- Q1>Change the name of hotel 'The Taj Bengal'
UPDATE HOTEL SET HOTELNAME = 'THE TAJ BENGAL' WHERE HOTELNAME = 'TAJBENGAL';
-- Q2>Change the default value of city of hotel table from kolkata to salt lake.
ALTER TABLE HOTEL MODIFY CITY VARCHAR(15) DEFAULT 'SALT LAKE';
-- Q3>Change the dateFrom of hotelNo H001 and guestNo G001 to 27-Jan-2014 and dateTo 07-Feb-2014.
UPDATE BOOKING SET DATEFROM = '2014-01-27', DATETO = '2014-02-07' WHERE HOTELNO = 'H001' AND GUESTNO = 'G001';
-- Q4>Add a column noOfGuest number(1) in booking table and insert some values to it.
ALTER TABLE BOOKING ADD NOOFGUEST INT;
UPDATE BOOKING SET NOOFGUEST = 2;
UPDATE BOOKING SET NOOFGUEST = 1 WHERE HOTELNO='H001';
-- Q5>Change the size of noOfGuest from 1 to 2.
ALTER TABLE BOOKING MODIFY NOOFGUEST INT(2);
-- Q6>Drop the column noOfGuest from booking table.
ALTER TABLE BOOKING DROP COLUMN NOOFGUEST;
-- Q7>Delete the table Corporate.
DELETE FROM CORPORATES WHERE GUESTNO = 'G001';
DELETE FROM CORPORATES; -- All data deleted

/* Aggregate Functions */
-- Q1>Count number of hotels in your database.
SELECT COUNT(*) FROM HOTEL;
-- Q2>Count number of hotels in different places.
SELECT CITY,COUNT(*) FROM HOTEL GROUP BY CITY;
-- Q3>Count number of 5 star hotels in kolkata.
SELECT COUNT(*) FROM HOTEL WHERE CITY='KOLKATA' AND STATUS=5;
-- Q4>Display non-AC room of minimum rate in hotel 'H003'
SELECT MIN(RATE) FROM ROOM WHERE TYPE='NAC' AND HOTELNO='H003';
-- Q5>Display the average rate of a room in different hotel.
SELECT HOTELNO, ROUND(AVG(RATE),2) AVG_ROOM_RATE FROM ROOM GROUP BY HOTELNO ORDER BY HOTELNO;
-- Q6>How many earned from double bed room from hotel 'H003'?
SELECT SUM(RATE) FROM ROOM WHERE BED='DOUBLE' AND HOTELNO='H003';
-- Q7>List the number of bookings of different type of rooms.
-- SELECT DISTINCT ROOMNO FROM BOOKING ORDER BY ROOMNO;
SELECT ROOMNO, COUNT(*) BOOKINGS FROM BOOKING GROUP BY ROOMNO ORDER BY ROOMNO ASC;
-- Q8>What is the nuumber of bookings that started in the month of February? 
SELECT COUNT(*) FEB_BOOKINGS FROM BOOKING WHERE EXTRACT(MONTH FROM DATEFROM)=2;
-- Q9>What is the maximum and minimum rate of room in Kolkata?
SELECT MAX(RATE),MIN(RATE) FROM ROOM WHERE HOTELNO IN(SELECT HOTELNO FROM HOTEL WHERE CITY='KOLKATA');
-- Q10>How many hotels have single bed non-AC below Rs.3000.00?
SELECT COUNT(DISTINCT HOTELNO) FROM ROOM WHERE BED = 'SINGLE' AND TYPE = 'NAC' AND RATE<3000;
-- Q11>What is the total revenue per night from all double bed AC rooms?
SELECT SUM(RATE) PER_NIGHT_REVENUE FROM ROOM WHERE BED='DOUBLE' AND TYPE='AC';
-- Q12>How many different guests have made bookings for January?
SELECT COUNT(DISTINCT GUESTNO) FROM BOOKING WHERE EXTRACT(MONTH FROM DATEFROM)=1;

/* Sub-queries and Joins */
-- Q1>List the rate and type of all rooms at the "Hyatt" Hotel.
SELECT RATE,TYPE FROM ROOM WHERE HOTELNO IN(SELECT HOTELNO FROM HOTEL WHERE HOTELNAME='HYATT');
SELECT ROOM.RATE, ROOM.TYPE FROM ROOM, HOTEL WHERE ROOM.HOTELNO = HOTEL.HOTELNO AND HOTEL.HOTELNAME='HYATT';
-- Q2>List hotel names, their room numbers, and type of that room
SELECT E1.HOTELNAME,E2.ROOMNO,E2.TYPE FROM HOTEL E1 INNER JOIN ROOM E2 ON E1.HOTELNO=E2.HOTELNO;
-- Q3>List the hotel names, booking dates, and room numbers of all 'AC' rooms in every 'Kolkata' based hotels
SELECT E1.HOTELNAME,E2.DATEFROM BOOKING_DATE,E3.ROOMNO 
FROM HOTEL E1 INNER JOIN BOOKING E2 ON E1.HOTELNO=E2.HOTELNO
INNER JOIN ROOM E3 ON E2.ROOMNO=E3.ROOMNO WHERE TYPE='AC' AND CITY='KOLKATA';
-- Q4>List identity proof details (only guestId) for all 'male' guest who have booked in hotel 'The Taj Bengal'
SELECT E1.GUESTNO FROM GUEST E1 INNER JOIN BOOKING E2 ON E1.GUESTNO = E2.GUESTNO
INNER JOIN HOTEL E3 ON E2.HOTELNO = E3.HOTELNO WHERE SEX='M' AND HOTELNAME = 'THE TAJ BENGAL';
-- Q5>List the 3star or 5star hotel names including room numbers and bed of any hotels(rooms) that have not been booked
SELECT HOTEL.HOTELNAME, ROOM.ROOMNO, ROOM.BED FROM BOOKING RIGHT JOIN ROOM ON BOOKING.ROOMNO = ROOM.ROOMNO 
INNER JOIN HOTEL ON HOTEL.HOTELNO = ROOM.HOTELNO
WHERE (STATUS=3 OR STATUS = 5) AND BOOKING.BOOKID IS NULL;
-- Q6>
SELECT HOTEL_NAME,CITY FROM HOTEL WHERE HOTEL_NO=(SELECT HOTEL_NO FROM ROOM WHERE RATE=(SELECT MAX(RATE) FROM ROOM));